@page "/gantt-demo"
@using GanttComponents.Models
@using GanttComponents.Components.TaskGrid
@using GanttComponents.Services
@inject IGanttTaskService TaskService

<PageTitle>Gantt Demo</PageTitle>

<h1>ðŸ“Š Gantt Demo</h1>

<div class="demo-container">
    <div class="demo-section">
        <h3>TaskGrid Section</h3>
        <p>Interactive hierarchical task grid with WBS codes, tree structure, and selection handling.</p>
        
        <div class="grid-container">
            <TaskGrid Tasks="@SampleTasks" 
                     OnTaskSelected="HandleTaskSelected" 
                     OnScrollChanged="HandleScrollChanged" />
        </div>
    </div>

    @if (SelectedTaskInfo != null)
    {
        <div class="demo-section">
            <h4>Selected Task Details</h4>
            <div class="task-info">
                <p><strong>ID:</strong> @SelectedTaskInfo.Id</p>
                <p><strong>WBS Code:</strong> @SelectedTaskInfo.WbsCode</p>
                <p><strong>Task Name:</strong> @SelectedTaskInfo.Name</p>
                <p><strong>Start Date:</strong> @SelectedTaskInfo.StartDate.ToString("MM/dd/yyyy")</p>
                <p><strong>End Date:</strong> @SelectedTaskInfo.EndDate.ToString("MM/dd/yyyy")</p>
                <p><strong>Duration:</strong> @SelectedTaskInfo.Duration</p>
                <p><strong>Progress:</strong> @SelectedTaskInfo.Progress%</p>
                <p><strong>Dependencies:</strong> @(SelectedTaskInfo.Predecessors ?? "None")</p>
            </div>
        </div>
    }

    <div class="demo-section">
        <h4>Design Decisions Implemented</h4>
        <ul>
            <li>âœ… <strong>Day-level scheduling</strong>: Dates displayed with day precision</li>
            <li>âœ… <strong>No batch operations</strong>: Single-task selection and immediate feedback</li>
            <li>âœ… <strong>Hierarchical structure</strong>: Parent-child relationships with expand/collapse</li>
            <li>âœ… <strong>WBS Code Foundation</strong>: Work Breakdown Structure codes with validation and service layer</li>
            <li>âœ… <strong>Row alignment service</strong>: Foundation for TaskGrid + TimelineView sync</li>
            <li>âœ… <strong>Material Design</strong>: CSS custom properties and clean styling</li>
            <li>âœ… <strong>Service Layer Architecture</strong>: Proper separation of concerns with IGanttTaskService</li>
            <li>ðŸ”„ <strong>Timeline component</strong>: Next milestone (Phase 1.2)</li>
            <li>ðŸ”„ <strong>Dependency rendering</strong>: Coming in Phase 2</li>
            <li>ðŸ”„ <strong>Resource management</strong>: Coming in Phase 2</li>
        </ul>
    </div>
</div>

@code {
    private List<GanttTask> SampleTasks = new();
    private GanttTask? SelectedTaskInfo;

    protected override async Task OnInitializedAsync()
    {
        await LoadTasksFromDatabase();
    }

    private async Task LoadTasksFromDatabase()
    {
        SampleTasks = await TaskService.GetAllTasksAsync();
        StateHasChanged();
    }

    private void HandleTaskSelected(int taskId)
    {
        SelectedTaskInfo = SampleTasks.FirstOrDefault(t => t.Id == taskId);
        StateHasChanged();
    }

    private void HandleScrollChanged(EventArgs args)
    {
        // This will be used for synchronizing with TimelineView scroll
        // For now, just logging the scroll position
        Console.WriteLine($"TaskGrid scrolled");
    }
}

<style>
    .demo-container {
        padding: 20px;
        max-width: 1200px;
        margin: 0 auto;
    }

    .demo-section {
        margin-bottom: 40px;
        padding: 20px;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        background: #fafafa;
    }

    .demo-section h3 {
        margin-top: 0;
        color: #1976d2;
    }

    .demo-section h4 {
        margin-top: 0;
        color: #333;
    }

    .grid-container {
        height: 400px;
        border: 1px solid #e0e0e0;
        border-radius: 4px;
        background: white;
    }

    .task-info {
        background: white;
        padding: 16px;
        border-radius: 4px;
        border: 1px solid #e0e0e0;
    }

    .task-info p {
        margin: 8px 0;
    }

    .demo-section ul {
        list-style: none;
        padding: 0;
    }

    .demo-section li {
        padding: 8px 0;
        border-bottom: 1px solid #e0e0e0;
    }

    .demo-section li:last-child {
        border-bottom: none;
    }
</style>
